## 누출 버킷 알고리즘

요청이 들어오면 토큰을 생성하여 버킷에 저장한 다음 요청을 처리하는 알고리즘으로 버킷이 꽉 차 있으면 그 다음에 들어오는 요청은 버리고, 버킷에 빈 공간이 있을 경우 다시 요청이 가능한 알고리즘이다.

토큰은 주기적으로 비어지며 버킷이 비어있으면 비우는 작업을 진행하지 않는다.

아래는 누출 버킷의 간략한 예시이다.

![img.png](assets/leaky-bucket/leaky-bucket-algorithm.png)

그럼 먼저 요구사항을 도출해보자.

### 요구사항

앞서 제시된 공통 요구사항중 API 요청에 관한 제한은 일단 제외하고 넘어가겠다.

**[기본 요구사항]**

- (공통) API 요청의 제한을 위한 임계치를 지정해야 한다.
- (버킷) 지정된 시간마다 큐에서 요청을 꺼내어 처리

API 요청에 대한 임계치는 Queue 의 사이즈를 의미하며 지정된 시간은 서비스 배치 또는 이벤트 스케쥴러가 동작하며 지정된 큐에서 Token 을 가져와 처리하는 방식이다.

이 스케쥴러가 동작하는 부분은 Spring Cloud 에서 처리를 해줘야 하는 부분이라 여기서는 누출 버킷에서 요청 정보는 제외하겠다.

**[추가 요구사항]**

- 임계치는 60 ~ 300 으로 지정하겠다.
- 토큰의 처리 속도는 1 ~ 10000 으로 지정하고 단위는 ms 이다.

## 행동과 객체를 분리

구현에 앞서 먼저 행동을 구분하겠다.

- 요청이 들어오면 토큰 버킷(TokenBucket) 이 가득 차있는지 확인 한 후 가득 차있지 않으면 토큰을 저장하고, 가득 차있으면 요청을 버린다. 
- 토큰 공급기(TokenIssuer) 가 토큰을 생성한 후 토큰 버킷(TokenBucket) 에 저장한다.
- 요청 처리기는 주기적으로 토큰의 정보를 가져와 요청을 처리한다.

**[행동]**

- 토큰을 생성
- 토큰을 버킷에 저장
- 토큰이 가득 차있는지 확인
- 토큰을 가져온다
- 토큰은 버킷에서 제거한다.

**[객체]**

- 토큰 버킷
- 토큰 공급기
- 토큰 처리기
- 토큰

### 구현



